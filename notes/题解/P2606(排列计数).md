---
aliases: ZJOI2010 排列计数
tags: 组合计数
---
# [ZJOI2010]排列计数

## 题意

求有多少个 $1\sim n$ 的排列 $p_1, p_2, \cdots , p_n$ 使得
$$
\forall i\in[2, n],p_i > p_{\lfloor \frac{i}{2} \rfloor}
$$

## 做法

$>$ 是一个二元的关系，二元关系通常用有向边来表示

由于
$$
p_{\lfloor \frac{i}{2} \rfloor} < p_i
$$
所以对于每个 $i$，向 $\lfloor \dfrac{i}{2} \rfloor$ 连一条边

每个点只会连出一条边，$1$ 不向外连边，最终构成一棵树，而且是完全二叉树

指定 $1$ 为根，则树满足根节点的权值小于子树内的所有节点

问题转变为一棵完全二叉树赋一个排列的点权使得满足对每个子树，根节点的权值小于子树内所有点的权值

根节点的权值必定是最小值，只要左子树和右子树分别满足性质即可

则
$$
ans[u]=\binom{siz[u]-1}{siz[lson]}ans[lson]\times ans[rson]
$$
因为无论选了什么数，分入左右子树时都可以再次离散化变成一个排列，所以左右子树和根节点的考虑方式是一样的

这里重点是划分成若干个**互不相关**的情况再组合起来计算